/*
Copyright 2012, KISSY UI Library v1.20
MIT Licensed
build time: May 23 21:24
*/
KISSY.add("waterfall/base",function(d,g,h){function a(){a.superclass.constructor.apply(this,arguments);this._init()}function k(b,c,j,l){var a=[].concat(d.makeArray(b)),f={},e;0<a.length?e=setTimeout(function(){var f=+new Date;do{var d=a.shift();c.call(j,d)}while(0<a.length&&50>+new Date-f);0<a.length?e=setTimeout(arguments.callee,25):l&&l.call(j,b)},25):l&&d.later(l,0,!1,j,[b]);f.stop=function(){e&&(clearTimeout(e),a=[])};return f}function m(){var b=this._containerRegion;b&&this.get("container").width()===
b.width||this.adjust()}function i(){var b=this.get("container").width(),c=this.get("curColHeights");c.length=Math.max(parseInt(b/this.get("colWidth")),this.get("minColCount"));this._containerRegion={width:b};d.each(c,function(b,a){c[a]=0})}function e(b){for(var c=this.get("effect"),j=this.get("align"),b=n(b),a=this.get("curColHeights"),e=this.get("container"),f=a.length,d=0,i=this._containerRegion,g=Number.MAX_VALUE,h=0;h<f;h++)a[h]<g&&(g=a[h],d=h);f||(g=0);f="left"===j?0:Math.max(i.width-f*this.get("colWidth"),
0);"center"===j&&(f/=2);b.css({left:d*this.get("colWidth")+f,top:g});e.contains(b)||(c&&"fadeIn"==c.effect&&b.css("opacity",0),e.append(b));a[d]+=b.outerHeight(!0);return b}var n=g.all;a.ATTRS={container:{setter:function(b){return n(b)}},curColHeights:{value:[]},minColCount:{value:1},effect:{value:{effect:"fadeIn",duration:1}},align:{value:"center"},colWidth:{}};d.extend(a,h,{isAdjusting:function(){return!!this._adjuster},_init:function(){m.call(this);this.__onResize=d.buffer(m,50,this);n(window).on("resize",
this.__onResize)},adjust:function(b){var c=this,a=c.get("container").all(".ks-waterfall"),e=a.length;c.isAdjusting()&&c._adjuster.stop();i.call(c);return c._adjuster=k(a,c._addItem,c,function(){c.get("container").height(Math.max.apply(Math,c.get("curColHeights")));c._adjuster=0;b&&b.call(c);e&&c.fire("adjustComplete",{items:a})})},addItems:function(b,c){var a=this,e=b.length;a._adder=k(b,a._addItem,a,function(){a.get("container").height(Math.max.apply(Math,a.get("curColHeights")));a._adder=0;c&&c.call(a);
e&&a.fire("addComplete",{items:b})});return a._adder},_addItem:function(b){this.get("curColHeights");this.get("container");var a=e.call(this,b),b=this.get("effect");b.effect&&"fadeIn"===b.effect&&a.animate({opacity:1},{duration:b.duration,easing:b.easing,complete:function(){a.css("opacity","")}})},destroy:function(){n(window).detach("resize",this.__onResize)}});return a},{requires:["node","base"]});
KISSY.add("waterfall/loader",function(d,g,h){function a(){a.superclass.constructor.apply(this,arguments)}function k(){if(!this.__pause&&!this.__loading)if(this.isAdjusting())this.__onScroll();else{var a=this.get("container").offset().top,d=this.get("diff"),b=this.get("curColHeights");b.length&&(a+=Math.min.apply(Math,b));d+i(window).scrollTop()+i(window).height()>a&&m.call(this)}}function m(){function a(c){b.__loading=0;b.addItems(c)}function d(){b.end()}var b=this;this.get("container");b.__loading=
1;var c=b.get("load");c&&c(a,d)}var i=g.all;a.ATTRS={diff:{getter:function(a){return a||0}}};d.extend(a,h,{_init:function(){a.superclass._init.apply(this,arguments);this.__onScroll=d.buffer(k,50,this);i(window).on("scroll",this.__onScroll);k.call(this)},end:function(){i(window).detach("scroll",this.__onScroll)},pause:function(){this.__pause=1},resume:function(){this.__pause=0},destroy:function(){a.superclass.destroy.apply(this,arguments);i(window).detach("scroll",this.__onScroll)}});return a},{requires:["node",
"./base"]});KISSY.add("waterfall",function(d,g,h){g.Loader=h;return g},{requires:["waterfall/base","waterfall/loader"]});
