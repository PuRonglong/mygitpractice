/*
Copyright 2012, KISSY UI Library v1.20
MIT Licensed
build time: Aug 14 15:03
*/
KISSY.add("dd/ddm",function(i,f,l,e,d,a){function j(){j.superclass.constructor.apply(this,arguments)}function h(m,a){var c=m.get("activeDrag"),h=c.get("mode"),k=m.get("drops"),d,e=0,n=0,f=o(c.get("node")),j=b(f);i.each(k,function(m){var k;if(k=m.getNodeFromTarget(a,c.get("dragNode")[0],c.get("node")[0]))if("point"==h)g(o(k),c.mousePos)&&(k=b(o(k)),d?k<n&&(d=m,n=k):(d=m,n=k));else if("intersect"==h)k=b(v(f,o(k))),k>n&&(n=k,d=m);else if("strict"==h&&(k=b(v(f,o(k))),k==j))return d=m,!1});if((e=m.get("activeDrop"))&&
e!=d)e._handleOut(a),c._handleOut(a);m.set("activeDrop",d);d&&(e!=d?d._handleEnter(a):d._handleOver(a))}function c(b){var a=document;b._shim=(new d("<div style='background-color:red;position:"+(x?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+p.get("dragCursor")+";z-index:"+w+";'></div>")).prependTo(a.body||a.documentElement).css("opacity",0);c=n;if(x)e.on(y,"resize scroll",u,b);n(b)}function n(b){var a=b.get("activeDrag").get("activeHandler"),c="auto";a&&(c=a.css("cursor"));"auto"==
c&&(c=b.get("dragCursor"));b._shim.css({cursor:c,display:"block"});x&&u.call(b)}function o(b){var a=b.offset();return{left:a.left,right:a.left+b.outerWidth(),top:a.top,bottom:a.top+b.outerHeight()}}function g(b,a){return b.left<=a.left&&b.right>=a.left&&b.top<=a.top&&b.bottom>=a.top}function b(b){return b.top>=b.bottom||b.left>=b.right?0:(b.right-b.left)*(b.bottom-b.top)}function v(b,a){var c=Math.max(b.top,a.top),k=Math.min(b.right,a.right),v=Math.min(b.bottom,a.bottom);return{left:Math.max(b.left,
a.left),right:k,top:c,bottom:v}}var k=document,y=window,x=6===f.ie,q=i.throttle(function(b){var a=this.__activeToDrag,c=this.get("activeDrag");(c||a)&&b.preventDefault();c?(c._move(b),h(this,b)):a&&a._move(b)},30),w=999999;j.ATTRS={prefixCls:{value:"ks-dd-"},dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1E3},activeDrag:{},activeDrop:{},drops:{value:[]}};var u=i.throttle(function(){var b;(b=this.get("activeDrag"))&&b.get("shim")&&this._shim.css({width:l.docWidth(),height:l.docHeight()})},
30);i.extend(j,a,{__activeToDrag:0,_regDrop:function(b){this.get("drops").push(b)},_unregDrop:function(b){b=i.indexOf(b,this.get("drops"));-1!=b&&this.get("drops").splice(b,1)},_regToDrag:function(b){e.on(k,r,this._end,this);e.on(k,t,q,this);this.__activeToDrag=b},_start:function(){var b=this.__activeToDrag;this.set("activeDrag",b);this.__activeToDrag=0;b.get("shim")&&c(this);this.fire("dragstart",{drag:b})},_end:function(){var b=this.get("activeDrag"),a=this.get("activeDrop"),c={drag:b,drop:a};e.remove(k,
t,q,this);e.remove(k,r,this._end,this);this.__activeToDrag&&(this.__activeToDrag._end(),this.__activeToDrag=0);this._shim&&this._shim.hide();b&&(b._end(),a?(a._end(),this.fire("drophit",c),this.fire("dragdrophit",c)):this.fire("dragdropmiss",{drag:b}),this.fire("dragend",{drag:b}),this.set("activeDrag",null),this.set("activeDrop",null))}});var p=new j;p.inRegion=g;p.region=o;p.area=b;f="ontouchstart"in k;p.DRAG_START_EVENT=f?"touchstart":"mousedown";var t=p.DRAG_MOVE_EVENT=f?"touchmove":"mousemove",
r=p.DRAG_END_EVENT=f?"touchend":"mouseup";p._normalHandlePreDragStart=function(b){return function(a){var c;if(c=a.originalEvent.touches){if(1!=c.length)return;c=c[0];a.target=a.target||c.target;a.currentTarget=a.currentTarget||c.currentTarget;a.button=a.button||0}b.call(this,a)}};return p},{requires:["ua","dom","event","node","base"]});
KISSY.add("dd/draggable",function(i,f,l,e,d){function a(){a.superclass.constructor.apply(this,arguments);this._init()}function j(){return!1}var h=i.each,c=f.ie,n=document;a.POINT="point";a.INTERSECT="intersect";a.STRICT="strict";a.ATTRS={node:{setter:function(b){return l.one(b)}},clickPixelThresh:{valueFn:function(){return d.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return d.get("bufferTime")}},dragNode:{},shim:{value:!0},handlers:{value:[],getter:function(b){var a=this;b.length||(b[0]=
a.get("node"));h(b,function(c,g){i.isFunction(c)&&(c=c.call(a));if(i.isString(c)||c.nodeType)c=l.one(c);b[g]=c});a.__set("handlers",b);return b}},activeHandler:{},dragging:{value:!1,setter:function(b){this.get("dragNode")[b?"addClass":"removeClass"](d.get("prefixCls")+"dragging")}},mode:{value:"point"},disabled:{value:!1,setter:function(b){this.get("dragNode")[b?"addClass":"removeClass"](d.get("prefixCls")+"-disabled");return b}},move:{value:!1},primaryButtonOnly:{value:!0},halt:{value:!0}};var o,
g=d._normalHandlePreDragStart(function(b){var a=b.target;this._checkMouseDown(b)&&this._check(a)&&this._prepare(b)});i.extend(a,e,{startMousePos:null,startNodePos:null,_diff:null,_bufferTimer:null,_init:function(){var b=this.get("node");this.set("dragNode",b);b.on(d.DRAG_START_EVENT,g,this).on("dragstart",this._fixDragStart)},_fixDragStart:function(b){b.preventDefault()},destroy:function(){this.get("dragNode").detach(d.DRAG_START_EVENT,g,this).detach("dragstart",this._fixDragStart);this.detach()},
_check:function(b){var a=this,c=a.get("handlers"),g=0;h(c,function(c){if(c.contains(b)||c[0]==b)return g=1,a.set("activeHandler",c),!1});return g},_checkMouseDown:function(b){return this.get("primaryButtonOnly")&&1<b.button||this.get("disabled")?0:1},_prepare:function(b){var a=this;c&&(o=n.body.onselectstart,n.body.onselectstart=j);a.get("halt")?b.halt():b.preventDefault();var g=a.get("node"),h=b.pageX,b=b.pageY,g=g.offset();a.startMousePos=a.mousePos={left:h,top:b};a.startNodePos=g;a._diff={left:h-
g.left,top:b-g.top};d._regToDrag(a);if(h=a.get("bufferTime"))a._bufferTimer=setTimeout(function(){a._start()},h)},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),this._bufferTimer=0)},_move:function(b){var a,c=this._diff;a=this.startMousePos;var g=b.pageX,b=b.pageY,h=g-c.left,c=b-c.top;this.get("dragging")?(this.mousePos={left:g,top:b},a={left:h,top:c,pageX:g,pageY:b,drag:this},g=1,!1===this.fire("drag",a)&&(g=0),!1===d.fire("drag",a)&&(g=0),g&&this.get("move")&&this.get("node").offset(a)):
(c=this.get("clickPixelThresh"),(Math.abs(g-a.left)>=c||Math.abs(b-a.top)>=c)&&this._start())},_end:function(){var b;this._clearBufferTimer();c&&(n.body.onselectstart=o);this.get("dragging")&&(this.get("node").removeClass(d.get("prefixCls")+"drag-over"),(b=d.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:b}):this.fire("dragdropmiss",{drag:this}),this.set("dragging",0),this.fire("dragend",{drag:this}))},_handleOut:function(){this.get("node").removeClass(d.get("prefixCls")+"drag-over");
this.fire("dragexit",{drag:this,drop:d.get("activeDrop")})},_handleEnter:function(b){this.get("node").addClass(d.get("prefixCls")+"drag-over");this.fire("dragenter",b)},_handleOver:function(b){this.fire("dragover",b)},_start:function(){this._clearBufferTimer();this.set("dragging",1);d._start();this.fire("dragstart",{drag:this})}});return a},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable",function(i,f,l,e){function d(){d.superclass.constructor.apply(this,arguments);this._init()}d.ATTRS={node:{setter:function(a){if(a)return f.one(a)}}};i.extend(d,l,{getNodeFromTarget:function(a,d,h){var a=this.get("node"),c=a[0];return c==d||c==h?null:a},_init:function(){e._regDrop(this)},__getCustomEvt:function(a){return i.mix({drag:e.get("activeDrag"),drop:this},a)},_handleOut:function(){var a=this.__getCustomEvt();this.get("node").removeClass(e.get("prefixCls")+"drop-over");
this.fire("dropexit",a);e.fire("dropexit",a);e.fire("dragexit",a)},_handleEnter:function(a){a=this.__getCustomEvt(a);a.drag._handleEnter(a);this.get("node").addClass(e.get("prefixCls")+"drop-over");this.fire("dropenter",a);e.fire("dragenter",a);e.fire("dropenter",a)},_handleOver:function(a){a=this.__getCustomEvt(a);a.drag._handleOver(a);this.fire("dropover",a);e.fire("dragover",a);e.fire("dropover",a)},_end:function(){var a=this.__getCustomEvt();this.get("node").removeClass(e.get("prefixCls")+"drop-over");
this.fire("drophit",a)},destroy:function(){e._unregDrop(this)}});return d},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(i,f,l){function e(){e.superclass.constructor.apply(this,arguments);this[d]={}}var d="__proxy_destructors",a=i.stamp,j=i.guid("__dd_proxy"),h="__proxy";e.ATTRS={node:{value:function(a){return new f(a.get("node").clone(!0))}},destroyOnEnd:{value:!1},moveOnEnd:{value:!0}};i.extend(e,l,{attach:function(c){function e(){var b=g.get("node"),a=c.get("node");g[h]?b=g[h]:i.isFunction(b)&&(b=b(c),b.addClass("ks-dd-proxy"),b.css("position","absolute"),g[h]=b);a.parent().append(b);
b.show();b.offset(a.offset());c.__set("dragNode",a);c.__set("node",b)}function f(){var b=g[h];g.get("moveOnEnd")&&c.get("dragNode").offset(b.offset());g.get("destroyOnEnd")?(b.remove(),g[h]=0):b.hide();c.__set("node",c.get("dragNode"))}var g=this,b=a(c,1,j);if(!b||!g[d][b])c.on("dragstart",e),c.on("dragend",f),b=a(c,0,j),g[d][b]={drag:c,fn:function(){c.detach("dragstart",e);c.detach("dragend",f)}}},unAttach:function(c){var c=a(c,1,j),h=this[d];c&&h[c]&&(h[c].fn(),delete h[c])},destroy:function(){var a=
this.get("node"),h=this[d];a&&!i.isFunction(a)&&a.remove();for(var e in h)this.unAttach(h[e].drag)}});return e},{requires:["node","base"]});
KISSY.add("dd/draggable-delegate",function(i,f,l,e,d){function a(){a.superclass.constructor.apply(this,arguments)}var j=f._normalHandlePreDragStart(function(a){var c,e;if(this._checkMouseDown(a)){c=this.get("handlers");var f=new d(a.target);(c=c.length?this._getHandler(f):f)&&(e=this._getNode(c));e&&(this.__set("activeHandler",c),this.__set("node",e),this.__set("dragNode",e),this._prepare(a))}});i.extend(a,l,{_init:function(){this.get("container").on(f.DRAG_START_EVENT,j,this).on("dragstart",this._fixDragStart)},
_getHandler:function(a){for(var c,d=this.get("container"),f=this.get("handlers");a&&a[0]!==d[0];){i.each(f,function(g){if(e.test(a[0],g))return c=a,!1});if(c)break;a=a.parent()}return c},_getNode:function(a){return a.closest(this.get("selector"),this.get("container"))},destroy:function(){this.get("container").detach(f.DRAG_START_EVENT,j,this).detach("dragstart",this._fixDragStart);this.detach()}},{ATTRS:{container:{setter:function(a){return d.one(a)}},selector:{},handlers:{value:[],getter:0},disabled:{setter:function(a){this.get("container")[a?
"addClass":"removeClass"](f.get("prefixCls")+"-disabled");return a}}}});return a},{requires:["./ddm","./draggable","dom","node"]});
KISSY.add("dd/droppable-delegate",function(i,f,l,e,d){function a(){var a=this.get("container"),c=this.get("selector");this.__allNodes=a.all(c)}function j(){j.superclass.constructor.apply(this,arguments);f.on("dragstart",a,this)}i.extend(j,l,{getNodeFromTarget:function(a,c,d){var e={left:a.pageX,top:a.pageY},a=this.__allNodes,g=0,b=Number.MAX_VALUE;a&&a.each(function(a){var h=a[0];if(!(h===d||h===c)&&f.inRegion(f.region(a),e))h=f.area(f.region(a)),h<b&&(b=h,g=a)});g&&(this.set("lastNode",this.get("node")),
this.set("node",g));return g},_handleOut:function(){j.superclass._handleOut.apply(this,arguments);this.set("node",0);this.set("lastNode",0)},_handleOver:function(a){var c=this.get("node"),d=j.superclass._handleOut,e=j.superclass._handleOver,g=j.superclass._handleEnter,b=this.get("lastNode");b[0]!==c[0]?(this.set("node",b),d.apply(this,arguments),this.set("node",c),g.call(this,a)):e.call(this,a)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(a){return d.one(a)}}}});return j},{requires:["./ddm",
"./droppable","dom","node"]});
KISSY.add("dd/scroll",function(i,f,l,e,d){function a(){a.superclass.constructor.apply(this,arguments);this[n]={}}var j=window,h=i.stamp,c=100,n="__dd_scrolls";a.ATTRS={node:{valueFn:function(){return e.one(j)},setter:function(a){return e.one(a)}},rate:{value:[10,10]},diff:{value:[20,20]}};var o=i.isWindow;i.extend(a,l,{getRegion:function(a){return o(a[0])?{width:d.viewportWidth(),height:d.viewportHeight()}:{width:a.outerWidth(),height:a.outerHeight()}},getOffset:function(a){return o(a[0])?{left:d.scrollLeft(),
top:d.scrollTop()}:a.offset()},getScroll:function(a){return{left:a.scrollLeft(),top:a.scrollTop()}},setScroll:function(a,b){a.scrollLeft(b.left);a.scrollTop(b.top)},unAttach:function(a){var b,c=this[n];if((b=h(a,1,"__dd-scroll-id-"))&&c[b])c[b].fn(),delete c[b]},destroy:function(){var a=this[n],b;for(b in a)this.unAttach(a[b].drag)},attach:function(a){function b(){if(o(q[0]))return 0;var b=a.mousePos,c=f.region(q);return!f.inRegion(c,b)?(clearTimeout(s),s=0,1):0}function d(c){!c.fake&&!b()&&(r=c,
m=i.clone(a.mousePos),c=l.getOffset(q),m.left-=c.left,m.top-=c.top,s||j())}function e(){clearTimeout(s);s=null}function j(){if(!b()){var d=l.getRegion(q),e=d.width,d=d.height,f=l.getScroll(q),h=i.clone(f),k=!1;m.top-d>=-t[1]&&(f.top+=p[1],k=!0);m.top<=t[1]&&(f.top-=p[1],k=!0);m.left-e>=-t[0]&&(f.left+=p[0],k=!0);m.left<=t[0]&&(f.left-=p[0],k=!0);k?(l.setScroll(q,f),s=setTimeout(j,c),r.fake=!0,o(q[0])&&(f=l.getScroll(q),r.left+=f.left-h.left,r.top+=f.top-h.top),a.get("move")&&a.get("node").offset(r),
a.fire("drag",r)):s=null}}var l=this,q=l.get("node"),w=h(a,0,"__dd-scroll-id-"),u=l[n];if(!u[w]){var p=l.get("rate"),t=l.get("diff"),r,m,s=null;a.on("drag",d);a.on("dragend",e);u[w]={drag:a,fn:function(){a.detach("drag",d);a.detach("dragend",e)}}}}});return a},{requires:["./ddm","base","node","dom"]});KISSY.add("dd",function(i,f,l,e,d,a,j,h){f={Draggable:l,Droppable:e,DDM:f,Proxy:d,DraggableDelegate:a,DroppableDelegate:j,Scroll:h};i.mix(i,f);return f},{requires:"dd/ddm,dd/draggable,dd/droppable,dd/proxy,dd/draggable-delegate,dd/droppable-delegate,dd/scroll".split(",")});
