/*
Copyright 2012, KISSY UI Library v1.20
MIT Licensed
build time: Nov 2 11:44
*/
KISSY.add("ajax/base",function(d,g,i,h){function b(a){a=d.mix(d.clone(q),a||{},void 0,void 0,!0);if(!d.isBoolean(a.crossDomain)){var f=l.exec(a.url.toLowerCase());a.crossDomain=!(!f||!(f[1]!=m[1]||f[2]!=m[2]||(f[3]||("http:"===f[1]?k:p))!=(m[3]||("http:"===m[1]?k:p))))}a.processData&&a.data&&!d.isString(a.data)&&(a.data=d.param(a.data,void 0,void 0,a.serializeArray));a.type=a.type.toUpperCase();a.hasContent=!n.test(a.type);if(!a.hasContent&&(a.data&&(a.url+=(/\?/.test(a.url)?"&":"?")+a.data),!1===
a.cache))a.url+=(/\?/.test(a.url)?"&":"?")+"_ksTS="+(d.now()+"_"+d.guid());a.dataType=d.trim(a.dataType||"*").split(c);a.context=a.context||a;return a}function a(a,c){e.fire(a,{ajaxConfig:c.config,xhr:c})}function f(c){var f=this.config,c=c.type;this.timeoutTimer&&clearTimeout(this.timeoutTimer);f[c]&&f[c].call(f.context,this.responseData,this.statusText,this);a(c,this)}function e(c){if(c.url){var c=b(c),e=new h(c);a("start",e);var l=new (r[c.dataType[0]]||r["*"])(e);e.transport=l;c.contentType&&
e.setRequestHeader("Content-Type",c.contentType);var k=c.dataType[0],o=c.accepts;e.setRequestHeader("Accept",k&&o[k]?o[k]+("*"===k?"":", */*; q=0.01"):o["*"]);for(var d in c.headers)e.setRequestHeader(d,c.headers[d]);e.on("complete success error",f);e.readyState=1;a("send",e);c.async&&0<c.timeout&&(e.timeoutTimer=setTimeout(function(){e.abort("timeout")},1E3*c.timeout));try{e.state=1,l.send()}catch(g){2>e.status&&e.callback(-1,g)}return e}}var c=/\s+/,l=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,
o=function(a){return a},k=80,p=443,n=/^(?:GET|HEAD)$/,j,m;try{j=location.href}catch(s){j=document.createElement("a"),j.href="",j=j.href}m=l.exec(j);j=/^(?:about|app|app\-storage|.+\-extension|file|widget):$/.test(m[1]);var r={},q={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:g.parse,
html:o,text:o,xml:d.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};q.converters.html=q.converters.text;d.mix(e,i.Target);d.mix(e,{isLocal:j,setupConfig:function(a){d.mix(q,a,void 0,void 0,!0)},setupTransport:function(a,c){r[a]=c},getTransport:function(a){return r[a]},getConfig:function(){return q}});return e},{requires:["json","event","./xhrobject"]});
KISSY.add("ajax/form-serializer",function(d,g){var i=/^(?:select|textarea)/i,h=/\r?\n/g,b=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return{serialize:function(a){var f=[],e={};g.query(a).each(function(a){a=a.elements?d.makeArray(a.elements):[a];f.push.apply(f,a)});f=d.filter(f,function(a){return a.name&&!a.disabled&&(a.checked||i.test(a.nodeName)||b.test(a.type))});d.each(f,function(a){var f=g.val(a),f=d.map(d.makeArray(f),function(a){return a.replace(h,
"\r\n")}),a=e[a.name]=e[a.name]||[];a.push.apply(a,f)});return d.param(e,void 0,void 0,!1)}}},{requires:["dom"]});
KISSY.add("ajax/form",function(d,g,i,h){g.on("start",function(b){b=b.xhr.config;if(b.form){var a=i.get(b.form);if("multipart/form-data"!=(a.encoding||a.enctype).toLowerCase()){if(a=h.serialize(a))b.hasContent?(b.data=b.data||"",b.data&&(b.data+="&"),b.data+=a):b.url+=(/\?/.test(b.url)?"&":"?")+a}else a=b.dataType[0],"*"==a&&(a="text"),b.dataType.length=2,b.dataType[0]="iframe",b.dataType[1]=a}});return g},{requires:["./base","dom","./form-serializer"]});
KISSY.add("ajax/iframe-upload",function(d,g,i,h){function b(a){this.xhr=a}var a=document;h.setupConfig({converters:{iframe:h.getConfig().converters.text,text:{iframe:function(a){return a}}}});d.augment(b,{send:function(){var f=this.xhr,e=f.config,c,b=g.get(e.form);this.attrs={target:g.attr(b,"target")||"",action:g.attr(b,"action")||""};this.form=b;var o=d.guid("ajax-iframe");f.iframe=g.create("<iframe  id='"+o+"' name='"+o+"' style='position:absolute;left:-9999px;top:-9999px;'/>");f.iframeId=o;g.prepend(f.iframe,
a.body||a.documentElement);g.attr(b,{target:f.iframeId,action:e.url});if(e.data){c=e.data;e=e.serializeArray;c=d.unparam(c);var o=[],k;for(k in c)for(var h=d.isArray(c[k]),n=d.makeArray(c[k]),j=0;j<n.length;j++){var m=a.createElement("input");m.type="hidden";m.name=k+(h&&e?"[]":"");m.value=n[j];g.append(m,b);o.push(m)}c=o}this.fields=c;i.on(f.iframe,"load error",this._callback,this);b.submit()},_callback:function(a){var b=this.xhr,a=a.type,c=b.iframe;if(c){g.attr(this.form,this.attrs);if("load"==
a)try{var l=c.contentWindow.document;l?(b.responseXML=l,b.responseText=g.text(l.body),b.callback(200,"success")):b.callback(500,"parser error")}catch(o){b.callback(500,"parser error")}else"error"==a&&b.callback(500,"error");g.remove(this.fields);i.detach(c);setTimeout(function(){g.remove(c)},30);b.iframe=null}},abort:function(){this._callback(0,1)}});h.setupTransport("iframe",b);return h},{requires:["dom","event","./base"]});
KISSY.add("ajax/jsonp",function(d,g){g.setupConfig({jsonp:"callback",jsonpCallback:function(){return d.guid("jsonp")}});g.on("start",function(g){var g=g.xhr,h=g.config;if("jsonp"==h.dataType[0]){var b,a=h.jsonpCallback,f=d.isFunction(a)?a():a,e=window[f];h.url+=(/\?/.test(h.url)?"&":"?")+h.jsonp+"="+f;window[f]=function(a){1<arguments.length&&(a=d.makeArray(arguments));b=[a]};g.on("complete",function(){window[f]=e;if(void 0===e)try{delete window[f]}catch(a){}else b&&e(b[0])});g.converters=g.converters||
{};g.converters.script=g.converters.script||{};g.converters.script.json=function(){return b[0]};h.dataType.length=2;h.dataType[0]="script";h.dataType[1]="json"}});return g},{requires:["./base"]});
KISSY.add("ajax/script",function(d,g){function i(b){if(!b.config.crossDomain&&!b.config.forceScript)return new (g.getTransport("*"))(b);this.xhrObj=b;return 0}var h=document;g.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(b){d.globalEval(b);return b}}}});d.augment(i,{send:function(){var b=this,a,f=this.xhrObj.config,e=h.head||h.getElementsByTagName("head")[0]||
h.documentElement;b.head=e;a=h.createElement("script");b.script=a;a.async="async";f.scriptCharset&&(a.charset=f.scriptCharset);a.src=f.url;a.onerror=a.onload=a.onreadystatechange=function(a){a=a||window.event;b._callback((a.type||"error").toLowerCase())};e.insertBefore(a,e.firstChild)},_callback:function(b,a){var f=this.script,e=this.xhrObj,c=this.head;if(f&&(a||!f.readyState||/loaded|complete/.test(f.readyState)||"error"==b))f.onerror=f.onload=f.onreadystatechange=null,c&&f.parentNode&&c.removeChild(f),
this.head=this.script=void 0,!a&&"error"!=b?e.callback(200,"success"):"error"==b&&e.callback(500,"scripterror")},abort:function(){this._callback(0,1)}});g.setupTransport("script",i);return g},{requires:["./base","./xhr"]});
KISSY.add("ajax/subdomain",function(d,g,i,h){function b(a){var c=a.config;this.xhrObj=a;a=c.url.match(f);this.__hostname=a[2];this.__protocol=a[1];c.crossDomain=!1}function a(){var b=c[this.__hostname];b.ready=1;i.detach(b.iframe,"load",a,this);this.send()}var f=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,e=document,c={};d.augment(b,g.proto,{send:function(){var b=this.xhrObj.config,f=this.__hostname,k=c[f],d="/sub_domain_proxy.html";b.xdr&&b.xdr.subDomain&&b.xdr.subDomain.proxy&&(d=b.xdr.subDomain.proxy);
k&&k.ready?(this.xhr=g.xhr(0,k.iframe.contentWindow))&&this.sendInternal():(k?b=k.iframe:(k=c[f]={},b=k.iframe=document.createElement("iframe"),h.css(b,{position:"absolute",left:"-9999px",top:"-9999px"}),h.prepend(b,e.body||e.documentElement),b.src=this.__protocol+"//"+f+d),i.on(b,"load",a,this))}});return b},{requires:["./xhrbase","event","dom"]});
KISSY.add("ajax/xdr",function(d,g,i){function h(a,b,e){l||(l=!0,a='<object id="'+f+'" type="application/x-shockwave-flash" data="'+a+'" width="0" height="0"><param name="movie" value="'+a+'" /><param name="FlashVars" value="yid='+b+"&uid="+e+'&host=KISSY.io" /><param name="allowScriptAccess" value="always" /></object>',b=c.createElement("div"),i.prepend(b,c.body||c.documentElement),b.innerHTML=a)}function b(a){this.xhrObj=a}var a={},f="io_swf",e,c=document,l=!1;d.augment(b,{send:function(){var b=
this,c=b.xhrObj.config;h((c.xdr||{}).src||d.Config.base+"ajax/io.swf",1,1);e?(b._uid=d.guid(),a[b._uid]=b,e.send(c.url,{id:b._uid,uid:b._uid,method:c.type,data:c.hasContent&&c.data||{}})):setTimeout(function(){b.send()},200)},abort:function(){e.abort(this._uid)},_xdrResponse:function(b,c){var f,e=this.xhrObj;e.responseText=decodeURI(c.c.responseText);switch(b){case "success":f={status:200,statusText:"success"};delete a[c.id];break;case "abort":delete a[c.id];break;case "timeout":case "transport error":case "failure":delete a[c.id],
f={status:500,statusText:b}}f&&e.callback(f.status,f.statusText)}});g.applyTo=function(a,b,c){var a=b.split("."),f=d;d.each(a,function(a){f=f[a]});f.apply(null,c)};g.xdrReady=function(){e=c.getElementById(f)};g.xdrResponse=function(b,c,f){var e=a[c.uid];e&&e._xdrResponse(b,c,f)};d.io=g;return b},{requires:["./base","dom"]});
KISSY.add("ajax/xhr",function(d,g,i,h,b){var a=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,f=window.XDomainRequest,e=i.xhr();if(e){var c=function(a){a=a.split(".");return 2>a.length?a.join("."):a.reverse().slice(0,2).reverse().join(".")},l=function(d){var g=d.config,l=g.xdr||{};if(g.crossDomain){g=g.url.match(a);if(c(location.hostname)==c(g[2]))return new h(d);if(!("withCredentials"in e)&&("flash"===""+l.use||!f))return new b(d)}this.xhrObj=d};d.augment(l,i.proto,{send:function(){this.xhr=i.xhr(this.xhrObj.config.crossDomain);
this.sendInternal()}});g.setupTransport("*",l)}return g},{requires:["./base","./xhrbase","./subdomain","./xdr"]});
KISSY.add("ajax/xhrbase",function(d,g){function i(a,b){try{return new (b||h).XMLHttpRequest}catch(c){}}var h=window,b=h.XDomainRequest,a={proto:{}};a.xhr=h.ActiveXObject?function(a,e){var c;if(a&&b)c=new b;else if(!(c=!g.isLocal&&i(a,e)))a:{try{c=new (e||h).ActiveXObject("Microsoft.XMLHTTP");break a}catch(d){}c=void 0}return c}:i;d.mix(a.proto,{sendInternal:function(){var a=this,e=a.xhrObj,c=e.config,d=a.xhr,g,h;c.username?d.open(c.type,c.url,c.async,c.username,c.password):d.open(c.type,c.url,c.async);
if(g=c.xhrFields)for(h in g)d[h]=g[h];e.mimeType&&d.overrideMimeType&&d.overrideMimeType(e.mimeType);!c.crossDomain&&!e.requestHeaders["X-Requested-With"]&&(e.requestHeaders["X-Requested-With"]="XMLHttpRequest");try{if(!c.crossDomain)for(h in e.requestHeaders)d.setRequestHeader(h,e.requestHeaders[h])}catch(i){}d.send(c.hasContent&&c.data||null);!c.async||4==d.readyState?a._callback():b&&d instanceof b?(d.onload=function(){d.readyState=4;d.status=200;a._callback()},d.onerror=function(){d.readyState=
4;d.status=500;a._callback()}):d.onreadystatechange=function(){a._callback()}},abort:function(){this._callback(0,1)},_callback:function(a,e){var c=this.xhr,h=this.xhrObj,i=h.config;try{if(e||4==c.readyState)if(b&&c instanceof b?(c.onerror=d.noop,c.onload=d.noop):c.onreadystatechange=d.noop,e)4!==c.readyState&&c.abort();else{var k=c.status;b&&c instanceof b||(h.responseHeadersString=c.getAllResponseHeaders());var p=c.responseXML;p&&p.documentElement&&(h.responseXML=p);h.responseText=c.responseText;
try{var n=c.statusText}catch(j){n=""}!k&&g.isLocal&&!i.crossDomain?k=h.responseText?200:404:1223===k&&(k=204);h.callback(k,n)}}catch(m){c.onreadystatechange=d.noop,e||h.callback(-1,m)}}});return a},{requires:["./base"]});
KISSY.add("ajax/xhrobject",function(d,g){function i(a){var b=a.responseText,e=a.responseXML,c=a.config,g=c.converters,h=a.converters||{},i,p,n=c.contents,j=c.dataType;if(b||e){for(c=a.mimeType||a.getResponseHeader("Content-Type");"*"==j[0];)j.shift();if(!j.length)for(i in n)if(n[i].test(c)){j[0]!=i&&j.unshift(i);break}j[0]=j[0]||"text";"text"==j[0]&&void 0!==b?p=b:"xml"==j[0]&&void 0!==e?p=e:d.each(["text","xml"],function(a){var c=j[0];if(h[a]&&h[a][c]||g[a]&&g[a][c])return j.unshift(a),p="text"==
a?b:e,!1})}n=j[0];for(c=1;c<j.length;c++){i=j[c];var m=h[n]&&h[n][i]||g[n]&&g[n][i];if(!m)throw"no covert for "+n+" => "+i;p=m(p);n=i}a.responseData=p}function h(a){d.mix(this,{responseData:null,config:a||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null})}var b=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;d.augment(h,g.Target,{setRequestHeader:function(a,b){this.requestHeaders[a]=
b;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(a){var f;if(2===this.state){if(!this.responseHeaders)for(this.responseHeaders={};f=b.exec(this.responseHeadersString);)this.responseHeaders[f[1]]=f[2];f=this.responseHeaders[a]}return void 0===f?null:f},overrideMimeType:function(a){this.state||(this.mimeType=a);return this},abort:function(a){a=a||"abort";this.transport&&this.transport.abort(a);this.callback(0,a);return this},
callback:function(a,b){if(2!=this.state){this.state=2;this.readyState=4;var d;if(200<=a&&300>a||304==a)if(304==a)b="notmodified",d=!0;else try{i(this),b="success",d=!0}catch(c){b="parsererror : "+c}else 0>a&&(a=0);this.status=a;this.statusText=b;d?this.fire("success"):this.fire("error");this.fire("complete");this.transport=void 0}}});return h},{requires:["event"]});
KISSY.add("ajax",function(d,g,i){d.mix(i,{serialize:g.serialize,get:function(g,b,a,f,e){d.isFunction(b)&&(f=a,a=b,b=void 0);return i({type:e||"get",url:g,data:b,success:a,dataType:f})},post:function(g,b,a,f){d.isFunction(b)&&(f=a,a=b,b=void 0);return i.get(g,b,a,f,"post")},jsonp:function(g,b,a){d.isFunction(b)&&(a=b,b=void 0);return i.get(g,b,a,"jsonp")},getScript:d.getScript,getJSON:function(g,b,a){d.isFunction(b)&&(a=b,b=void 0);return i.get(g,b,a,"json")},upload:function(g,b,a,f,e){d.isFunction(a)&&
(e=f,f=a,a=void 0);return i({url:g,type:"post",dataType:e,form:b,data:a,success:f})}});return i},{requires:"ajax/form-serializer,ajax/base,ajax/xhrobject,ajax/xhr,ajax/script,ajax/jsonp,ajax/form,ajax/iframe-upload".split(",")});
