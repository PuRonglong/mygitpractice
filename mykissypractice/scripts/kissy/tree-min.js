/*
Copyright 2013, KISSY UI Library v1.20
MIT Licensed
build time: Apr 11 16:35
*/
KISSY.add("tree/basenode",function(f,c,d,a,e){var g=c.all,k=e.ITEM_CLS,i=c.KeyCodes,h=d.create(a.ModelControl,[a.DecorateChild],{_keyNav:function(b){var g=!0,a,c=this.get("children");switch(b.keyCode){case i.HOME:a=this.get("tree");break;case i.END:a=this.get("tree").getLastVisibleDescendant();break;case i.UP:a=this.getPreviousVisibleNode();break;case i.DOWN:a=this.getNextVisibleNode();break;case i.LEFT:this.get("expanded")&&(c.length||!1===this.get("isLeaf"))?this.set("expanded",!1):a=this.get("parent");
break;case i.RIGHT:if(c.length||!1===this.get("isLeaf"))this.get("expanded")?c[0].select():this.set("expanded",!0);break;default:g=!1}a&&a.select();return g},getLastVisibleDescendant:function(){var b=this.get("children");return!this.get("expanded")||!b.length?this:b[b.length-1].getLastVisibleDescendant()},getNextVisibleNode:function(){var b=this.get("children"),a=this.get("parent");if(this.get("expanded")&&b.length)return b[0];for(b=this.next();a&&!b;)b=a.next(),a=a.get("parent");return b},getPreviousVisibleNode:function(){var b=
this.prev();return b=b?b.getLastVisibleDescendant():this.get("parent")},next:function(){var b=this.get("parent");if(!b)return null;var b=b.get("children"),a=f.indexOf(this,b);return a==b.length-1?null:b[a+1]},prev:function(){var b=this.get("parent");if(!b)return null;var b=b.get("children"),a=f.indexOf(this,b);return 0===a?null:b[a-1]},select:function(){this.get("tree").set("selectedItem",this)},_performInternal:function(b){var a=g(b.target),c=this.get("tree"),e=this.get("view");c.get("el")[0].focus();
a.equals(e.get("expandIconEl"))?"dblclick"!=b.type&&this.set("expanded",!this.get("expanded")):"dblclick"==b.type?this.set("expanded",!this.get("expanded")):(this.select(),c.fire("click",{target:this}))},decorateChildrenInternal:function(b,a,g){this.addChild(new b({srcNode:a,tree:this.get("tree"),prefixCls:g}))},addChild:function(b,a){var g=this.get("tree");void 0===a&&(a=this.get("children").length);b.set("tree",g);b.set("depth",this.get("depth")+1);h.superclass.addChild.apply(this,arguments);this._updateRecursive(a);
g._register(b);f.each(b.get("children"),function(b){g._register(b)})},_computeClass:function(b){this.get("view")._computeClass(this.get("children"),this.get("parent"),b)},_updateRecursive:function(b){var a,g=this.get("children"),c=g.length;this._computeClass("_updateRecursive");for(b=Math.max(b-1,0);b<c;b++)a=g[b],a._computeClass("_updateRecursive_children"),a.get("view").set("ariaPosInSet",b+1),a.get("view").set("ariaSize",c)},removeChild:function(b){var a=this.get("tree");a._unregister(b);f.each(b.get("children"),
function(b){a._unregister(b)});var g=f.indexOf(b,this.get("children"));h.superclass.removeChild.apply(this,f.makeArray(arguments));this._updateRecursive(g)},_uiSetExpanded:function(b){var a=this.get("tree");this._computeClass("expanded-"+b);b?a.fire("expand",{target:this}):a.fire("collapse",{target:this})},_uiSetSelected:function(b){this._forwardSetAttrToView("selected",b)},expandAll:function(){this.set("expanded",!0);f.each(this.get("children"),function(b){b.expandAll()})},collapseAll:function(){this.set("expanded",
!1);f.each(this.get("children"),function(b){b.collapseAll()})}},{DefaultRender:e,ATTRS:{handleMouseEvents:{value:!1},id:{getter:function(){var b=this.get("el").attr("id");b||this.get("el").attr("id",b=f.guid("tree-node"));return b}},content:{view:!0},isLeaf:{view:!0},expandIconEl:{view:!0},iconEl:{view:!0},selected:{},expanded:{value:!1,view:!0},tooltip:{view:!0},tree:{},depth:{value:0,view:!0},focusable:{value:!1},decorateChildCls:{value:"tree-children"}},HTML_PARSER:{expanded:function(b){b=b.one("."+
this.getCls("tree-children"));return!b?!1:"none"!=b.css("display")}}});a.UIStore.setUIByClass(k,{priority:10,ui:h});return h},{requires:["node","uibase","component","./basenoderender"]});
KISSY.add("tree/basenoderender",function(f,c,d,a){var e=c.all;return d.create(a.Render,{_computeClass:function(a,c){var e=this.get("expanded"),d=this.get("isLeaf"),b=this.get("iconEl"),j=this.get("expandIconEl"),n=this.get("childrenEl"),l="inline-block tree-icon tree-expand-icon ",o=this.getCls("inline-block tree-icon tree-file-icon "),p=this.getCls(["inline-block tree-icon",e?"tree-expanded-folder-icon":"tree-collapsed-folder-icon",""].join(" ")),m=!c||c.get("children")[c.get("children").length-
1].get("view")==this;!1===d||void 0===d&&a.length?(b.attr("class",p),j.attr("class",this.getCls(f.substitute(e?l+"tree-expand-icon-{t}minus":l+"tree-expand-icon-{t}plus",{t:m?"l":"t"})))):(b.attr("class",o),j.attr("class",this.getCls(f.substitute(l+"tree-expand-icon-{t}",{t:m?"l":"t"}))));n&&n.attr("class",this.getCls(m?"tree-lchildren":"tree-children"))},createDom:function(){var a=this.get("el"),c,d,h=this.get("labelEl");d=e("<div class='"+this.getCls("tree-row")+"'/>");c=f.guid("tree-item");this.set("rowEl",
d);var b=e("<div/>").appendTo(d),j=e("<div />").appendTo(d);h||(h=e("<span id='"+c+"' class='"+this.getCls("tree-item-label")+"'/>"),this.set("labelEl",h));h.appendTo(d);a.attr({role:"treeitem","aria-labelledby":c}).prepend(d);this.set("expandIconEl",b);this.set("iconEl",j)},_uiSetExpanded:function(a){var c=this.get("childrenEl");c&&(a?a&&c.show():c.hide());this.get("el").attr("aria-expanded",a)},_setSelected:function(a,c){this.get("rowEl")[a?"addClass":"removeClass"](this._completeClasses(c,"-selected"));
this.get("el").attr("aria-selected",a)},_uiSetContent:function(a){this.get("labelEl").html(a)},_uiSetDepth:function(a){this.get("el").attr("aria-level",a)},_uiSetAriaSize:function(a){this.get("el").attr("aria-setsize",a)},_uiSetAriaPosInSet:function(a){this.get("el").attr("aria-posinset",a)},_uiSetTooltip:function(a){this.get("el").attr("title",a)},getContentElement:function(){if(this.get("childrenEl"))return this.get("childrenEl");var a=e("<div "+(this.get("expanded")?"":"style='display:none'")+
" role='group'></div>").appendTo(this.get("el"));this.set("childrenEl",a);return a}},{ATTRS:{ariaSize:{},ariaPosInSet:{},childrenEl:{},expandIconEl:{},tooltip:{},iconEl:{},expanded:{},rowEl:{},depth:{},labelEl:{},content:{},isLeaf:{}},HTML_PARSER:{childrenEl:function(a){return a.children("."+this.getCls("tree-children"))},labelEl:function(a){return a.children("."+this.getCls("tree-item-label"))},content:function(a){return a.children("."+this.getCls("tree-item-label")).html()},isLeaf:function(a){if(a.hasClass(this.getCls("tree-item-leaf")))return!0;
if(a.hasClass(this.getCls("tree-item-folder")))return!1}},ITEM_CLS:"tree-item"})},{requires:["node","uibase","component"]});
KISSY.add("tree/checknode",function(f,c,d,a,e,g){var k=c.all,c=d.create(e,{_performInternal:function(a){this.get("tree").get("el")[0].focus();var c=k(a.target),b=this.get("view"),e=this.get("tree");if("dblclick"==a.type){if(c.equals(b.get("expandIconEl"))||c.equals(b.get("checkEl")))return;this.set("expanded",!this.get("expanded"))}c.equals(b.get("expandIconEl"))?this.set("expanded",!this.get("expanded")):(a=this.get("checkState"),this.set("checkState",1==a?0:1),e.fire("click",{target:this}))},_uiSetCheckState:function(a){(1==
a||0==a)&&f.each(this.get("children"),function(b){b.set("checkState",a)});var c=this.get("parent");if(c){for(var b=0,e=c.get("children"),d=0;d<e.length;d++){var g=e[d].get("checkState");if(2==g){c.set("checkState",2);return}1==g&&b++}b==e.length?c.set("checkState",1):0===b?c.set("checkState",0):c.set("checkState",2)}}},{ATTRS:{checkState:{view:!0,value:0}},CHECK_CLS:"tree-item-check",DefaultRender:g,PARTIAL_CHECK:2,CHECK:1,EMPTY:0});a.UIStore.setUIByClass("tree-item-check",{priority:a.UIStore.PRIORITY.LEVEL2,
ui:c});return c},{requires:["node","uibase","component","./basenode","./checknoderender"]});
KISSY.add("tree/checknoderender",function(f,c,d,a,e){var g=c.all;return d.create(e,{createDom:function(){var a=this.get("expandIconEl");this.set("checkEl",g("<div class='"+this.getCls("inline-block  tree-icon")+"'/>").insertAfter(a))},_uiSetCheckState:function(a){this.get("checkEl").removeClass(this.getCls("tree-item-checked0 tree-item-checked1 tree-item-checked2")).addClass(this.getCls("tree-item-checked"+a))}},{ATTRS:{checkEl:{},checkState:{}},CHECK_CLS:"tree-item-check"})},{requires:["node","uibase",
"component","./basenoderender"]});KISSY.add("tree/checktree",function(f,c,d,a,e,g){f=e.CHECK_TREE_CLS;c=c.create(a,[d.DelegateChildren,g],{},{DefaultRender:e});d.UIStore.setUIByClass(f,{priority:d.UIStore.PRIORITY.LEVEL4,ui:c});return c},{requires:["uibase","component","./checknode","./checktreerender","./treemgr"]});KISSY.add("tree/checktreerender",function(f,c,d,a,e){return c.create(a,[e],{},{CHECK_TREE_CLS:"tree-root-check"})},{requires:["uibase","component","./checknoderender","./treemgrrender"]});
KISSY.add("tree/tree",function(f,c,d,a,e,g){f=e.TREE_CLS;c=c.create(a,[d.DelegateChildren,g],{},{DefaultRender:e});d.UIStore.setUIByClass(f,{priority:d.UIStore.PRIORITY.LEVEL3,ui:c});return c},{requires:["uibase","component","./basenode","./treerender","./treemgr"]});
KISSY.add("tree/treemgr",function(f,c){function d(){}d.ATTRS={showRootNode:{view:!0},selectedItem:{},tree:{valueFn:function(){return this}},focusable:{value:!0}};f.augment(d,{__getAllNodes:function(){this._allNodes||(this._allNodes={});return this._allNodes},__renderUI:function(){this.get("children").length||this._computeClass("root_renderUI")},_register:function(a){this.__getAllNodes()[a.get("id")]=a},_unregister:function(a){delete this.__getAllNodes()[a.get("id")]},_handleKeyEventInternal:function(a){var e=
this.get("selectedItem");return a.keyCode==c.KeyCodes.ENTER?e._performInternal(a):e._keyNav(a)},getOwnerControl:function(a){for(var c,d=this.__getAllNodes(),f=this.get("el")[0];a&&a!==f;){if(c=d[a.id])return c;a=a.parentNode}return this},_uiSetSelectedItem:function(a,c){c.prevVal&&c.prevVal.set("selected",!1);a.set("selected",!0)},_uiSetFocused:function(a){this.constructor.superclass._uiSetFocused.call(this,a);a&&!this.get("selectedItem")&&this.select()}});return d},{requires:["event"]});
KISSY.add("tree/treemgrrender",function(f){function c(){}c.ATTRS={showRootNode:{}};f.augment(c,{__renderUI:function(){this.get("el").attr("role","tree")[0].hideFocus=!0;this.get("rowEl").addClass(this.getCls("tree-root-row"))},_uiSetShowRootNode:function(c){this.get("rowEl")[c?"show":"hide"]()},_uiSetFocused:function(c){this.get("el")[c?"addClass":"removeClass"](this.getCls("tree-item-focused"))}});return c});
KISSY.add("tree/treerender",function(f,c,d,a,e){return c.create(a,[e],{},{TREE_CLS:"tree-root"})},{requires:["uibase","component","./basenoderender","./treemgrrender"]});KISSY.add("tree",function(f,c,d,a,e){c.Node=d;c.CheckNode=a;c.CheckTree=e;return c},{requires:["tree/tree","tree/basenode","tree/checknode","tree/checktree"]});
