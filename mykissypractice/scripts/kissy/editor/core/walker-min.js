KISSY.Editor.add("walker",function(l){function h(b,c){if(this._.end)return j;var a,d=this.range,f,g=this.guard,h=this.type,k=b?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start&&(this._.start=1,d.trim(),d.collapsed))return this.end(),j;if(!b&&!this._.guardLTR){var l=d.endContainer,n=new p(l[0].childNodes[d.endOffset]);this._.guardLTR=function(a,b){return(a=q._4e_wrap(a))&&a[0]&&(!b||!q._4e_equals(l,a))&&(!n[0]||!a._4e_equals(n))&&(a[0].nodeType!=m.NODE_ELEMENT||!b||"body"!=a._4e_name())}}if(b&&
!this._.guardRTL){var o=d.startContainer,r=0<d.startOffset&&new p(o[0].childNodes[d.startOffset-1]);this._.guardRTL=function(a,b){return(a=q._4e_wrap(a))&&a[0]&&(!b||!a._4e_equals(o))&&(!r[0]||!a._4e_equals(r))&&(a[0].nodeType!=m.NODE_ELEMENT||!b||"body"!=a._4e_name())}}var s=b?this._.guardRTL:this._.guardLTR;f=g?function(a,b){return s(a,b)===e?e:g(a,b)}:s;this.current?a=this.current[k](e,h,f):b?(a=d.endContainer,0<d.endOffset?(a=new p(a[0].childNodes[d.endOffset-1]),f(a)===e&&(a=j)):a=f(a,i)===e?
j:a._4e_previousSourceNode(i,h,f)):(a=d.startContainer,(a=new p(a[0].childNodes[d.startOffset]))&&a[0]?f(a)===e&&(a=j):a=f(d.startContainer,i)===e?j:d.startContainer._4e_nextSourceNode(i,h,f));for(;a&&a[0]&&!this._.end;){this.current=a;if(!this.evaluator||this.evaluator(a)!==e){if(!c)return a}else if(c&&this.evaluator)return e;a=a[k](e,h,f)}this.end();return this.current=j}function n(b){for(var c,a=j;c=h.call(this,b);)a=c;return a}function g(b){this.range=b;this._={}}var i=!0,e=!1,j=null,k=KISSY,
t=k.UA,m=l.NODE,q=k.DOM,o=l.XHTML_DTD,p=k.Node;k.augment(g,{end:function(){this._.end=1},next:function(){return h.call(this)},previous:function(){return h.call(this,i)},checkForward:function(){return h.call(this,e,i)!==e},checkBackward:function(){return h.call(this,i,i)!==e},lastForward:function(){return n.call(this)},lastBackward:function(){return n.call(this,i)},reset:function(){delete this.current;this._={}}});g.blockBoundary=function(b){return function(c){c=q._4e_wrap(c);return!(c&&c[0].nodeType==
m.NODE_ELEMENT&&c._4e_isBlockBoundary(b))}};g.bookmark=function(b,c){function a(a){return a&&a[0]&&"span"==a._4e_name()&&a.attr("_ke_bookmark")}return function(d){var f,e;f=d&&d[0]&&d[0].nodeType==m.NODE_TEXT&&(e=d.parent())&&a(e);f=b?f:f||a(d);return c^f}};g.whitespaces=function(b){return function(c){c=(c=c[0]||c)&&c.nodeType==m.NODE_TEXT&&!k.trim(c.nodeValue);return b^c}};g.invisible=function(b){var c=g.whitespaces();return function(a){a=c(a)||a[0].nodeType==m.NODE_ELEMENT&&!a[0].offsetHeight;return b^
a}};var u=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,v=g.whitespaces(),w=g.bookmark();g.getBogus=function(b){do b=b._4e_previousSourceNode();while(w(b)||v(b)||1==b[0].nodeType&&b._4e_name()in o.$inline&&!(b._4e_name()in o.$empty));return b&&(!t.ie?"br"==b._4e_name():3==b[0].nodeType&&u.test(b.text()))?b:!1};l.Walker=g});
