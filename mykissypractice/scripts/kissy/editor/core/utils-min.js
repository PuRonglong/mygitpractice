KISSY.Editor.add("utils",function(o){var p=null,e=KISSY,u=e.Node,g=e.DOM,j=e.UA,s=e.Event,t;t=j.ie?document.documentMode||j.ie:void 0;var r={debugUrl:function(a){a=a.replace(/-min\.(js|css)/i,".$1");o.Config.debug||(a=a.replace(/\.(js|css)/i,"-min.$1"));if(a.indexOf("?t")==-1){a+=a.indexOf("?")!=-1?"&":"?";a+="t="+encodeURIComponent("2012-01-11 13:45:11")}return o.Config.base+a},lazyRun:function(a,b,c){var d=a[b],f=a[c];a[b]=function(){d.apply(this,arguments);a[b]=a[c];return f.apply(this,arguments)}},
getXY:function(a,b,c,d){c=c.defaultView||c.parentWindow;a-=g.scrollLeft(c);b-=g.scrollTop(c);if(d)if(c!=(d.defaultView||d.parentWindow)&&c.frameElement){d=g._4e_getOffset(c.frameElement,d);a+=d.left;b+=d.top}return{left:a,top:b}},tryThese:function(){for(var a,b=0,c=arguments.length;b<c;b++){var d=arguments[b];try{a=d();break}catch(f){}}return a},arrayCompare:function(a,b){if(!a&&!b)return true;if(!a||!b||a.length!=b.length)return false;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return false;return true},
getByAddress:function(a,b,c){a=a.documentElement;for(var d=0;a&&d<b.length;d++){var f=b[d];if(c)for(var i=-1,h=0;h<a.childNodes.length;h++){var l=a.childNodes[h];if(!(c===true&&l.nodeType==3&&l.previousSibling&&l.previousSibling.nodeType==3)){i++;if(i==f){a=l;break}}}else a=a.childNodes[f]}return a?new u(a):p},clearAllMarkers:function(a){for(var b in a)a[b]._4e_clearMarkers(a,true)},htmlEncodeAttr:function(a){return a.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},ltrim:function(a){return a.replace(/^\s+/,
"")},rtrim:function(a){return a.replace(/\s+$/,"")},trim:function(a){return this.ltrim(this.rtrim(a))},mix:function(){for(var a={},b=0;b<arguments.length;b++)a=e.mix(a,arguments[b]);return a},isCustomDomain:function(){if(!j.ie)return false;var a=document.domain,b=window.location.hostname;return a!=b&&a!="["+b+"]"},buffer:function(a,b,c){c=c||0;var d=p;return function(){d&&clearTimeout(d);var f=arguments;d=setTimeout(function(){return a.apply(b,f)},c)}},isNumber:function(a){return/^\d+(.\d+)?$/.test(e.trim(a))},
verifyInputs:function(a){for(var b=0;b<a.length;b++){var c=g._4e_wrap(a[b]),d=e.trim(r.valInput(c)),f=c.attr("data-verify");c=c.attr("data-warning");if(f&&!RegExp(f).test(d)){alert(c);return false}}return true},sourceDisable:function(a,b){a.on("sourcemode",b.disable,b);a.on("wysiwygmode",b.enable,b)},resetInput:function(a){var b=a.attr("placeholder");if(b&&j.ie){a.addClass("ke-input-tip");a.val(b)}else j.ie||a.val("")},valInput:function(a,b){if(b===undefined)return a.hasClass("ke-input-tip")?"":a.val();
else{a.removeClass("ke-input-tip");a.val(b)}},placeholder:function(a,b){a.attr("placeholder",b);if(j.ie){a.on("blur",function(){if(!e.trim(a.val())){a.addClass("ke-input-tip");a.val(b)}});a.on("focus",function(){a.removeClass("ke-input-tip");e.trim(a.val())==b&&a.val("")})}},htmlEncode:function(a){return!a?a:String(a).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},normParams:function(a){a=e.clone(a);for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];if(e.isFunction(c))a[b]=
c()}return a},doFormUpload:function(a,b,c){function d(){var q={responseText:"",responseXML:p};q.argument=a?a.argument:p;try{var k;if((k=j.ie?i.contentWindow.document:i.contentDocument||window.frames[f].document)&&k.body)q.responseText=e.trim(g.text(k.body));q.responseXML=k&&k.XMLDocument?k.XMLDocument:k}catch(v){e.log("after data returns error ,maybe domain problem:");e.log(v,"error")}s.remove(i,"load",d);a.callback&&a.callback(q);setTimeout(function(){g._4e_remove(i)},100)}var f=e.guid("form-upload-"),
i=document.createElement("iframe");i.id=f;i.name=f;i.className="ke-hidden";var h="document.open();"+(r.isCustomDomain()?'document.domain="'+document.domain+'";':"")+"document.close();";if(j.ie)i.src=j.ie?"javascript:void(function(){"+encodeURIComponent(h)+"}())":"";e.log("doFormUpload : "+i.src);document.body.appendChild(i);if(j.ie)document.frames[f].name=f;h=g._4e_unwrap(a.form);var l={target:g.attr(h,"target"),method:g.attr(h,"method"),encoding:g.attr(h,"encoding"),enctype:g.attr(h,"enctype"),action:g.attr(h,
"action")};g.attr(h,{target:f,method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});c&&g.attr(h,"action",c);var m;if(b){m=[];b=o.Utils.normParams(b);for(var n in b)if(b.hasOwnProperty(n)){c=document.createElement("input");c.type="hidden";c.name=n;c.value=b[n];h.appendChild(c);m.push(c)}}s.on(i,"load",d);h.submit();g.attr(h,l);if(m){b=0;for(n=m.length;b<n;b++)g._4e_remove(m[b])}return i},map:function(a,b){for(var c=0;c<a.length;c++)a[c]=b(a[c]);return a},ieEngine:t,preventFocus:function(a){j.ie?
a._4e_unselectable():a.attr("onmousedown","return false;")},isFlashEmbed:function(a){a=a.attributes;return a.type=="application/x-shockwave-flash"||/\.swf(?:$|\?)/i.test(a.src||"")},addRes:function(){var a=this.__res=this.__res||[];a.push.apply(a,e.makeArray(arguments))},destroyRes:function(){for(var a=this.__res||[],b=0;b<a.length;b++){var c=a[b];if(e.isFunction(c))c();else{c.detach&&c.detach();c.destroy&&c.destroy();c.nodeType&&c.remove&&c.remove()}}this.__res=[]}};return o.Utils=r});
