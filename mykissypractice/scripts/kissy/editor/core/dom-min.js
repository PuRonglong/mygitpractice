KISSY.Editor.add("dom",function(o){function u(a){return a.replace(/-(\w)/g,function(b,c){return c.toUpperCase()})}var p=KISSY,k=p.DOM,n=p.UA,i=p.Node,s=o.Utils,v={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};o.NODE={NODE_ELEMENT:1,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11};o.NODE=o.NODE;o.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,
POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};o.POSITION=o.POSITION;var j=o.NODE,m=o.POSITION,w={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},x={hr:1},g=function(a){return a[0]||a},r=function(a){if(a&&!a[0])return new i(a);return a},t={_4e_wrap:r,_4e_unwrap:g,_4e_equals:function(a,b){if(!a&&!b)return true;if(!a||!b)return false;a=g(a);b=g(b);
return a===b},_4e_isBlockBoundary:function(a,b){a=r(a);var c=p.mix(p.mix({},x),b||{});return w[a.css("display")]||c[a._4e_name()]},_4e_getWin:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:false},_4e_index:function(a){a=g(a);for(var b=a.parentNode.childNodes,c=0;c<b.length;c++)if(b[c]===a)return c;return-1},_4e_first:function(a,b){a=g(a);var c=a.firstChild;if((c=c&&new i(c))&&b&&!b(c))c=c._4e_next(b);return c},_4e_move:function(a,b,c){a=g(a);k._4e_remove(a);
b=g(b);c?b.insertBefore(a,b.firstChild):b.appendChild(a)},_4e_name:function(a){a=g(a);var b=a.nodeName.toLowerCase();if(n.ie)if((a=a.scopeName)&&a!="HTML")b=a.toLowerCase()+":"+b;return b},_4e_isIdentical:function(a,b){if(a._4e_name()!=b._4e_name())return false;var c=a[0].attributes,d=b[0].attributes,e=c.length,f=d.length;if(e!=f)return false;for(var h=0;h<e;h++){var l=c[h],q=l.name;if(l.specified&&a.attr(q)!=b.attr(q))return false}if(s.ieEngine<8)for(h=0;h<f;h++){l=d[h];q=l.name;if(l.specified&&
a.attr(q)!=b.attr(q))return false}return true},_4e_isEmptyInlineRemoveable:function(a){a=g(a).childNodes;for(var b=0,c=a.length;b<c;b++){var d=a[b],e=d.nodeType;if(!(e==j.NODE_ELEMENT&&d.getAttribute("_ke_bookmark")))if(e==j.NODE_ELEMENT&&!t._4e_isEmptyInlineRemoveable(d)||e==j.NODE_TEXT&&p.trim(d.nodeValue))return false}return true},_4e_moveChildren:function(a,b,c){a=g(a);b=b[0]||b;if(a!=b)if(c)for(;c=a.lastChild;)b.insertBefore(a.removeChild(c),b.firstChild);else for(;c=a.firstChild;)b.appendChild(a.removeChild(c))},
_4e_mergeSiblings:function(){function a(b,c,d){if(c[0]&&c[0].nodeType==j.NODE_ELEMENT){for(var e=[];c.attr("_ke_bookmark")||c._4e_isEmptyInlineRemoveable();){e.push(c);c=d?new i(c[0].nextSibling):new i(c[0].previousSibling);if(!c[0]||c[0].nodeType!=j.NODE_ELEMENT)return}if(b._4e_isIdentical(c)){for(var f=d?b[0].lastChild:b[0].firstChild;e.length;)e.shift()._4e_move(b,!d);c._4e_moveChildren(b,!d);c._4e_remove();f[0]&&f[0].nodeType==j.NODE_ELEMENT&&f._4e_mergeSiblings()}}}return function(b){if(b[0])if(v[b._4e_name()]||
b._4e_name()=="a"){a(b,new i(b[0].nextSibling),true);a(b,new i(b[0].previousSibling))}}}(),_4e_unselectable:n.gecko?function(a){a=g(a);a.style.MozUserSelect="none"}:n.webkit?function(a){a=g(a);a.style.KhtmlUserSelect="none"}:function(a){a=g(a);if(n.ie||n.opera){var b=0;a.setAttribute("unselectable","on");for(var c=a.getElementsByTagName("*");a=c[b++];)switch(a.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:a.setAttribute("unselectable","on")}}},_4e_getOffset:function(a,
b){a=g(a);var c,d=0;c=0;var e=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,f=a.ownerDocument,h=f.documentElement;b=b||f;if(a.getBoundingClientRect){if(a!==f.body&&h!==a){c=a.getBoundingClientRect();d=c.left+(b===f?k.scrollLeft(e):0);c=c.top+(b===f?k.scrollTop(e):0)}if(b)if(e!=(b.defaultView||b.parentWindow)&&e.frameElement){e=t._4e_getOffset(e.frameElement,b);d+=e.left;c+=e.top}}return{left:d,top:c}},_4e_splitText:function(a,b){a=g(a);var c=a.ownerDocument;if(!(!a||a.nodeType!=j.NODE_TEXT)){if(n.ie&&
b==a.nodeValue.length){var d=c.createTextNode("");k.insertAfter(d,a);return new i(d)}d=new i(a.splitText(b));if(c.documentMode){c=c.createTextNode("");k.insertAfter(c,d[0]);k._4e_remove(c)}return d}},_4e_parents:function(a,b){a=r(a);var c=[];do c[b?"push":"unshift"](a);while(a=a.parent());return c},_4e_clone:function(a,b,c){a=g(a);a=a.cloneNode(b);if(!c){var d=function(e){if(e.nodeType==j.NODE_ELEMENT){e.removeAttribute("id");e=e.childNodes;for(var f=0;f<e.length;f++)d(e[f])}};d(a)}return new i(a)},
_4e_nextSourceNode:function(a,b,c,d){a=g(a);if(d&&!d.call){var e=d[0]||d;d=function(h){h=h[0]||h;return h!==e}}b=!b&&a.firstChild;var f=new i(a);if(!b){if(a.nodeType==j.NODE_ELEMENT&&d&&d(a,true)===false)return null;b=a.nextSibling}for(;!b&&(f=f.parent());){if(d&&d(f,true)===false)return null;b=f[0].nextSibling}if(!b)return null;b=k._4e_wrap(b);if(d&&d(b)===false)return null;if(c&&c!=b[0].nodeType)return b._4e_nextSourceNode(false,c,d);return b},_4e_previousSourceNode:function(a,b,c,d){a=g(a);if(d&&
!d.call){var e=d[0]||d;d=function(h){h=h[0]||h;return h!==e}}b=!b&&a.lastChild;var f=new i(a);if(!b){if(a.nodeType==j.NODE_ELEMENT&&d&&d(a,true)===false)return null;b=a.previousSibling}for(;!b&&(f=f.parent());){if(d&&d(f,true)===false)return null;b=f[0].previousSibling}if(!b)return null;b=k._4e_wrap(b);if(d&&d(b)===false)return null;if(c&&b[0].nodeType!=c)return b._4e_previousSourceNode(false,c,d);return b},_4e_commonAncestor:function(a,b){if(a._4e_equals(b))return a;if(b[0].nodeType!=j.NODE_TEXT&&
b.contains(a))return b;var c=a[0].nodeType==j.NODE_TEXT?a.parent():a;do if(c[0].nodeType!=j.NODE_TEXT&&c.contains(b))return c;while(c=c.parent());return null},_4e_ascendant:function(a,b,c){a=g(a);if(!c)a=a.parentNode;if(b&&!p.isFunction(b)){var d=b;b=function(e){return e._4e_name()==d}}for(;a&&a.nodeType!=9;){if(!b||b(new i(a))===true)return new i(a);a=a.parentNode}return null},_4e_hasAttribute:s.ieEngine<9?function(a,b){a=g(a);var c=a.getAttributeNode(b);return!!(c&&c.specified)}:function(a,b){a=
g(a);return a.hasAttribute(b)},_4e_hasAttributes:s.ieEngine<9?function(a){a=g(a);for(var b=a.attributes,c=0;c<b.length;c++){var d=b[c];switch(d.name){case "class":if(a.getAttribute("class"))return true;break;default:if(d.specified)return true}}return false}:function(a){a=g(a);n.gecko&&a.removeAttribute("_moz_dirty");return a.hasAttributes()},_4e_position:function(a,b){var c=g(a),d=g(b);if(c.compareDocumentPosition)return c.compareDocumentPosition(d);if(c==d)return m.POSITION_IDENTICAL;if(c.nodeType==
j.NODE_ELEMENT&&d.nodeType==j.NODE_ELEMENT){if(c.contains){if(c.contains(d))return m.POSITION_CONTAINS+m.POSITION_PRECEDING;if(d.contains(c))return m.POSITION_IS_CONTAINED+m.POSITION_FOLLOWING}if("sourceIndex"in c)return c.sourceIndex<0||d.sourceIndex<0?m.POSITION_DISCONNECTED:c.sourceIndex<d.sourceIndex?m.POSITION_PRECEDING:m.POSITION_FOLLOWING}c=a._4e_address();d=b._4e_address();for(var e=Math.min(c.length,d.length),f=0;f<=e-1;f++)if(c[f]!=d[f]){if(f<e)return c[f]<d[f]?m.POSITION_PRECEDING:m.POSITION_FOLLOWING;
break}return c.length<d.length?m.POSITION_CONTAINS+m.POSITION_PRECEDING:m.POSITION_IS_CONTAINED+m.POSITION_FOLLOWING},_4e_address:function(a,b){a=g(a);for(var c=[],d=a.ownerDocument.documentElement,e=a;e&&e!=d;){var f=e.parentNode,h=-1;if(f){for(var l=0;l<f.childNodes.length;l++){var q=f.childNodes[l];if(!(b&&q.nodeType==3&&q.previousSibling&&q.previousSibling.nodeType==3)){h++;if(q==e)break}}c.unshift(h)}e=f}return c},_4e_breakParent:function(a,b){var c=new o.Range(a[0].ownerDocument);c.setStartAfter(a);
c.setEndAfter(b);var d=c.extractContents();c.insertNode(a._4e_remove());a[0].parentNode.insertBefore(d,a[0].nextSibling)},_4e_style:function(a,b,c){if(c!==undefined){a=r(a);a.css(b,c);var d=a[0].style;c==""&&d.removeAttribute&&d.removeAttribute(b);d.cssText||a[0].removeAttribute("style")}else{a=g(a);return a.style[u(b)]}},_4e_remove:function(a,b){var c=g(a),d=c.parentNode;if(d){if(b)for(var e;e=c.firstChild;)d.insertBefore(c.removeChild(e),c);d.removeChild(c)}return a},_4e_trim:function(a){k._4e_ltrim(a);
k._4e_rtrim(a)},_4e_ltrim:function(a){a=g(a);for(var b;b=a.firstChild;){if(b.nodeType==j.NODE_TEXT){var c=s.ltrim(b.nodeValue),d=b.nodeValue.length;if(c){if(c.length<d){(new i(b))._4e_splitText(d-c.length);a.removeChild(a.firstChild)}}else{a.removeChild(b);continue}}break}},_4e_rtrim:function(a){a=g(a);for(var b;b=a.lastChild;){if(b.type==j.NODE_TEXT){var c=s.rtrim(b.nodeValue),d=b.nodeValue.length;if(c){if(c.length<d){(new i(b))._4e_splitText(c.length);a.removeChild(a.lastChild)}}else{a.removeChild(b);
continue}}break}if(!n.ie&&!n.opera)(b=a.lastChild)&&b.nodeType==1&&b.nodeName.toLowerCase()=="br"&&b.parentNode.removeChild(b)},_4e_appendBogus:function(a){a=g(a);for(var b=a.lastChild;b&&b.nodeType==j.NODE_TEXT&&!p.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==j.NODE_TEXT||k._4e_name(b)!=="br"){b=n.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");n.gecko&&b.setAttribute("type","_moz");a.appendChild(b)}},_4e_getBogus:function(a){return o.Walker.getBogus(r(a))},
_4e_previous:function(a,b){var c=g(a),d;do d=(c=c.previousSibling)&&new i(c);while(d&&b&&!b(d));return d},_4e_last:function(a,b){a=k._4e_wrap(a);var c=a[0].lastChild;if((c=c&&new i(c))&&b&&!b(c))c=c._4e_previous(b);return c},_4e_next:function(a,b){var c=g(a),d;do d=(c=c.nextSibling)&&new i(c);while(d&&b&&!b(d));return d},_4e_outerHtml:function(a){a=g(a);if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var b=a.ownerDocument.createElement("div");b.appendChild(a.cloneNode(true));return b.innerHTML},
_4e_setMarker:function(a,b,c,d){a=k._4e_wrap(a);var e=a.data("list_marker_id")||a.data("list_marker_id",p.guid()).data("list_marker_id"),f=a.data("list_marker_names")||a.data("list_marker_names",{}).data("list_marker_names");b[e]=a;f[c]=1;return a.data(c,d)},_4e_clearMarkers:function(a,b,c){a=r(a);var d=a.data("list_marker_names"),e=a.data("list_marker_id"),f;for(f in d)a.removeData(f);a.removeData("list_marker_names");if(c){a.removeData("list_marker_id");delete b[e]}},_4e_copyAttributes:function(a,
b,c){a=g(a);b=r(b);var d=a.attributes;c=c||{};for(var e=0;e<d.length;e++){var f=d[e],h=f.name.toLowerCase(),l;if(!(h in c))if(h=="checked"&&(l=k.attr(a,h)))b.attr(h,l);else if(f.specified||n.ie&&f.value&&h=="value"){l=k.attr(a,h);if(l===null)l=f.nodeValue;b.attr(h,l)}}if(a.style.cssText!=="")b[0].style.cssText=a.style.cssText},_4e_isEditable:function(a){a=k._4e_name(a);var b=o.XHTML_DTD;return(a=!b.$nonEditable[a]&&(b[a]||b.span))&&a["#"]},_4e_scrollIntoView:function(a){a=r(a);a.scrollIntoView(a[0].ownerDocument,
false)},_4e_getElementsByTagName:function(a,b,c){a=g(a);if(!n.ie&&c)b=c+":"+b;c=[];a=a.getElementsByTagName(b);for(b=0;b<a.length;b++)c.push(new i(a[b]));return c}};(function(a){p.mix(k,a);for(var b in a)a.hasOwnProperty(b)&&function(c){i.prototype[c]=function(){var d=[].slice.call(arguments,0);d.unshift(this);return a[c].apply(null,d)}}(b)})(t)});
