KISSY.Editor.add("flash/support",function(){function e(a){this.editor=a;this._init()}function n(a){return a._4e_name()==="img"&&!!a.hasClass(l)&&a}var h=KISSY,g=h.Editor,t=h.UA,p=h.Event,u=g.ContextMenu,v=h.Node,o=g.BubbleView,l="ke_flash",q=g.Utils.flash;h.augment(e,{_config:function(){this._cls=l;this._type="flash";this._contextMenu=w;this._flashRules=["img."+l]},_init:function(){this._config();var a=this,b=a.editor,d={},c=a._contextMenu;if(c)for(var f in c)(function(i){d[i]=function(){c[i](a)}})(f);
a._contextMenu=u.register({editor:b,rules:a._flashRules,width:"120px",funcs:d});o.attach({pluginName:a._type,editor:a.editor,pluginContext:a});p.on(b.document,"dblclick",a._dbclick,a)},_getFlashUrl:function(a){return q.getUrl(a)},_updateTip:function(a,b){var d=this.editor.restoreRealElement(b);if(d){d=this._getFlashUrl(d);a.attr("href",d)}},_dbclick:function(a){var b=new v(a.target);if(b._4e_name()==="img"&&b.hasClass(this._cls)){this.show(null,b);a.halt()}},show:function(a,b){this.editor.showDialog(this._type+
"/dialog",[b])},destroy:function(){var a=this.editor;this._contextMenu.destroy();o.destroy(this._type);p.remove(a.document,"dblclick",this._dbclick,this);a.destroyDialog(this._type+"/dialog")}});g.Flash=e;e.registerBubble=function(a,b,d){o.register({pluginName:a,func:d,init:function(){var c=this,f=c.get("contentEl");f.html(h.substitute(' <a class="ke-bubbleview-url" target="_blank" href="#">{label}</a>   |    <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span>   |    <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>',
{label:b}));var i=f.one(".ke-bubbleview-url"),k=f.one(".ke-bubbleview-change"),r=f.one(".ke-bubbleview-remove");g.Utils.preventFocus(f);k.on("click",function(j){c._plugin.show(null,c._selectedEl);j.halt()});r.on("click",function(j){var s=c._plugin;if(t.webkit){var m=s.editor.getSelection().getRanges();m&&m[0]&&(m[0].collapse(true)||1)&&m[0].select()}c._selectedEl._4e_remove();c.hide();s.editor.notifySelectionChange();j.halt()});g.Utils.addRes.call(c,k,r);c.on("show",function(){var j=c._selectedEl;
j&&c._plugin._updateTip(i,j)})}})};e.registerBubble("flash","\u5728\u65b0\u7a97\u53e3\u67e5\u770b",n);e.checkFlash=n;var w={"Flash\u5c5e\u6027":function(a){var b=a.editor.getSelection();b=b&&b.getStartElement();(b=n(b))&&a.show(null,b)}};e.CLS_FLASH=l;e.TYPE_FLASH="flash";e.Insert=function(a,b,d,c,f,i){b=q.createSWF(b,{attrs:d},a.document);var k=b.el;d=a.createFakeElement?a.createFakeElement(k,c||"ke_flash",f||"flash",true,b.html,d):k;a.insertElement(d,null,i)};g.Flash=e},{attach:false,requires:["bubbleview","contextmenu","flashutils"]});
