KISSY.Editor.add("removeformat",function(c){c.addPlugin("removeformat",function(){function k(d,f){for(var e=0;e<f.length;e++)d.removeAttr(f[e])}var b=KISSY.Editor,l=b.RANGE,m=b.ElementPath,j=b.NODE,n="class,style,lang,width,height,align,hspace,valign".split(/,/),i=RegExp("^(?:"+"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,s".replace(/,/g,"|")+")$","i"),o=c.addButton("removeformat",{title:"\u6e05\u9664\u683c\u5f0f",mode:b.WYSIWYG_MODE,contentCls:"ke-toolbar-removeformat",offClick:function(){var d=
this.editor;d.focus();i.lastIndex=0;var f=d.getSelection().getRanges();d.fire("save");for(var e=0,g;g=f[e];e++)if(!g.collapsed){g.enlarge(l.ENLARGE_ELEMENT);var b=g.createBookmark(),a=b.startNode,c=b.endNode,h=function(a){for(var b=new m(a),d=b.elements,e=1,c;(c=d[e])&&!c._4e_equals(b.block)&&!c._4e_equals(b.blockLimit);e++)i.test(c._4e_name())&&a._4e_breakParent(c)};h(a);h(c);for(a=a._4e_nextSourceNode(!0,j.NODE_ELEMENT);a&&!a._4e_equals(c);)h=a._4e_nextSourceNode(!1,j.NODE_ELEMENT),"img"==a._4e_name()&&
(a.attr("_ke_realelement")||/\bke_/.test(a[0].className))||(i.test(a._4e_name())?a._4e_remove(!0):k(a,n)),a=h;g.moveToBookmark(b)}d.getSelection().selectRanges(f);d.fire("save")}});this.destroy=function(){o.destroy()}})},{attach:!1});
